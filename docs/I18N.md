# KLineLens — i18n / 国际化

> 多语言支持策略和实现说明

---

## 当前状态：中英文双语 ✅

应用已实现完整的中英文国际化支持：
- 默认语言：中文
- 切换方式：Settings 页面
- 存储：localStorage 持久化

---

## 实现架构

### 1. 前端翻译层

文件：`apps/web/src/lib/i18n.tsx`

```typescript
// Context + Provider 模式
export type Language = 'zh' | 'en';

const translations: Record<Language, Record<string, string>> = {
  zh: { ... },
  en: { ... }
};

export function I18nProvider({ children }) { ... }
export function useI18n() { ... }
```

### 2. 使用方式

```typescript
import { useI18n } from '../lib/i18n';

function MyComponent() {
  const { t, lang, setLang } = useI18n();

  return (
    <div>
      <h2>{t('market_state')}</h2>
      <button onClick={() => setLang('en')}>English</button>
    </div>
  );
}
```

### 3. 存储

```
localStorage key: kline_lens_lang
values: "zh" | "en"
default: "zh"
```

---

## 翻译 Key 分类

### 通用 UI
| Key | 中文 | English |
|-----|------|---------|
| settings | 设置 | Settings |
| language | 语言 | Language |
| refresh | 刷新 | Refresh |
| loading | 加载中... | Loading... |

### 市场状态
| Key | 中文 | English |
|-----|------|---------|
| market_state | 市场状态 | Market State |
| uptrend | 上升趋势 | Uptrend |
| downtrend | 下降趋势 | Downtrend |
| range | 震荡区间 | Range |
| bias_bullish | 偏多 | Bullish |
| bias_bearish | 偏空 | Bearish |

### 行为推断
| Key | 中文 | English |
|-----|------|---------|
| behavior_inference | 行为推断 | Behavior Inference |
| accumulation | 吸筹 | Accumulation |
| shakeout | 洗盘 | Shakeout |
| markup | 拉升 | Markup |
| distribution | 派发 | Distribution |
| markdown | 下跌 | Markdown |

### 突破状态
| Key | 中文 | English |
|-----|------|---------|
| breakout_status | 突破状态 | Breakout Status |
| state_idle | 观望中 | Idle |
| state_attempt | 尝试突破 | Attempt |
| state_confirmed | 突破确认 | Confirmed |
| state_fakeout | 假突破 | Fakeout |
| volume_ratio | 量比 | Vol Ratio |
| confirm_closes | 确认K线 | Confirm Closes |

### 信号
| Key | 中文 | English |
|-----|------|---------|
| signals | 信号 | Signals |
| signal.breakout_attempt | 尝试突破 | Breakout Attempt |
| signal.breakout_confirmed | 突破确认 | Breakout Confirmed |
| signal.fakeout | 假突破 | Fakeout |

### 证据
| Key | 中文 | English |
|-----|------|---------|
| evidence | 支撑证据 | Evidence |
| evidence.shakeout.sweep_and_reclaim | 跌破支撑后快速收回 | Sweep and reclaim pattern |
| evidence.accumulation.near_support | 价格接近支撑区域 | Price near support zone |

### 交易剧本
| Key | 中文 | English |
|-----|------|---------|
| playbook | 交易剧本 | Playbook |
| entry | 入场 | Entry |
| target | 目标 | Target |
| stop_loss | 止损 | Stop Loss |
| risk_reward | 盈亏比 | R/R |
| recommended | 推荐 | Recommended |
| alternative | 备选 | Alternative |

### 时间线
| Key | 中文 | English |
|-----|------|---------|
| timeline | 时间线 | Timeline |
| initialized | 开始分析 | Analysis Started |
| regime_change | 市场状态转变 | Regime Changed |
| behavior_shift | 行为模式切换 | Behavior Shifted |

---

## 后端输出策略

后端输出 key，前端负责翻译：

```json
{
  "behavior": {
    "evidence": [
      {
        "note": "evidence.shakeout.sweep_and_reclaim",
        "metrics": {...}
      }
    ]
  }
}
```

前端：
```typescript
const translated = t(item.note); // "跌破支撑后快速收回"
```

---

## 添加新翻译

1. 在 `apps/web/src/lib/i18n.tsx` 的 `translations` 对象中添加：

```typescript
const translations = {
  zh: {
    // 添加中文
    'new_key': '新翻译',
  },
  en: {
    // 添加英文
    'new_key': 'New translation',
  }
};
```

2. 在组件中使用：

```typescript
const { t } = useI18n();
return <span>{t('new_key')}</span>;
```

---

## 未来扩展

- [ ] 更多语言支持（日语、韩语等）
- [ ] 自动检测浏览器语言
- [ ] 翻译文件外置（JSON）
